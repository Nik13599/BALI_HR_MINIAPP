import express from "express";
import fetch from "node-fetch";
import dotenv from "dotenv";
dotenv.config();

const app = express();
app.use(express.json());
app.use(express.static("frontend"));

const TOKEN = process.env.TELEGRAM_TOKEN;
const CHAT_ID = process.env.HR_CHAT_ID;
const API_URL = `https://api.telegram.org/bot${TOKEN}`;

app.post("/submit", async (req, res) => {
  const data = req.body;
  const msg = `
üíº –ù–æ–≤–∞—è –∞–Ω–∫–µ—Ç–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ BALI
üë§ –ò–º—è: ${data.name}
üéÇ –í–æ–∑—Ä–∞—Å—Ç: ${data.age}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}
üì∏ Instagram: ${data.social}
üíº –î–æ–ª–∂–Ω–æ—Å—Ç—å: ${data.position}
üìö –û–ø—ã—Ç: ${data.experience}
üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${data.comment}
üñº –§–æ—Ç–æ: ${data.photo}
`;
  await fetch(`${API_URL}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chat_id: CHAT_ID, text: msg }),
  });
  res.json({ ok: true });
});

app.listen(process.env.PORT || 8080, () =>
  console.log("BALI HR MiniApp –∑–∞–ø—É—â–µ–Ω–æ")
);
